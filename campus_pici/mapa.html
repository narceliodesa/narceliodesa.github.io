<!DOCTYPE html>
<html>
<head>
	
	<title>Teste Campus do Pici</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css" />
	<link rel="stylesheet" href="src/leaflet-geojson-selector.css" />
	<link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="mapid" style="width: 90%; height: 900px;"></div>

<select id="geofilter" size="3" multiple>
	<option value="data=[out:json];way[building=university](-3.757889,-38.586731,-3.735235,-38.562913);(._;>;);out;">Departamentos</option>
	<option value="data=[out:json];way[amenity=parking](-3.757889,-38.586731,-3.735235,-38.562913);(._;>;);out;">Estacionamentos</option>
	<option value="data=[out:json];node[natural=tree](-3.757889,-38.586731,-3.735235,-38.562913);(._;>;);out;" selected>Árvores</option>

</select>

<pre id="selection">&nbsp;</pre>

<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/leaflet/dist/leaflet.js"></script>
<script src="node_modules/osmtogeojson/osmtogeojson.js"></script>
<script src="src/leaflet-geojson-selector.js"></script>
<script>

	var map = L.map('mapid').setView([-3.747183,-38.572955], 16);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 22,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(map);;
	
	
		map.addControl(L.control.zoom({position:'topright'}));

		var geoLayer = L.geoJson().addTo(map);
		
		var geoList = L.control.geoJsonSelector(geoLayer, {
			listItemBuild: function(layer) {
				var props = layer.feature.properties,
					tags = props.tags,
					html = 'ID: '+props.id+'<br>';
				
				for(var p in tags)
					html += p+': '+tags[p]+'<br>';

				return html;
			}
		});

		geoList.on('change', function(e) {
			$('#selection').text( JSON.stringify(e.layers[0].feature.properties) );
		})
		.addTo(map);
		
		$('#geofilter').on('change', function(e) {

			$.ajax({
				data: this.value,
				type: 'post',
				dataType: 'json',
				url: 'http://overpass-api.de/api/interpreter',
				success: function(json) {

					map.removeLayer(geoLayer);

					var geojson = osmtogeojson(json);

					geoLayer = L.geoJson(geojson).addTo(map);

					map.fitBounds( geoLayer.getBounds() );

					geoList.reload( geoLayer );
				}
			});
		}).trigger('change');

</script>
</body>
</html>
